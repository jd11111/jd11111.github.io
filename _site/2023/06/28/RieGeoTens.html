<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" href="/assets/main.css"><!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-CKNVMY5C33"></script>
<script>
  MathJax = {
    tex: {
      packages: ['base'],
      tags: 'ams',
      packages: {'[+]': ['ams','mathtools']},
      inlineMath: [['$','$']], 
      displayMath: [["$$","$$"]],
      processEscapes: true,      // use \$ to produce a literal dollar sign
      processEnvironments: true, // process \begin{xxx}...\end{xxx} outside math mode
      processRefs: true,         // process \ref{...} outside of math mode
      formatError:               // function called when TeX syntax errors occur
          (jax, err) => jax.formatError(err)
    }
  }; 
</script>
<script type="text/javascript" id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', 'G-CKNVMY5C33');
</script></head>
<body><header class="site-header" role="banner">

  <div class="wrapper"><a class="site-title" rel="author" href="/">Jannik&#39;s Blog</a><nav class="site-nav">
        <input type="checkbox" id="nav-trigger" class="nav-trigger" />
        <label for="nav-trigger">
          <span class="menu-icon">
            <svg viewBox="0 0 18 15" width="18px" height="15px">
              <path d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.032C17.335,0,18,0.665,18,1.484L18,1.484z M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.032C17.335,6.031,18,6.696,18,7.516L18,7.516z M18,13.516C18,14.335,17.335,15,16.516,15H1.484 C0.665,15,0,14.335,0,13.516l0,0c0-0.82,0.665-1.483,1.484-1.483h15.032C17.335,12.031,18,12.695,18,13.516L18,13.516z"/>
            </svg>
          </span>
        </label>

        <div class="trigger"><a class="page-link" href="/about/">About</a></div>
      </nav></div>
</header>
<main class="page-content" aria-label="Content">
      <div class="wrapper">
        <article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">
    <h1 class="post-title p-name" itemprop="name headline">Curvature and Derivative On Riemannian Manifolds With Sympy Tensor</h1>
    <p class="post-meta">
      <time class="dt-published" datetime="2023-06-28T11:14:45+02:00" itemprop="datePublished">Jun 28, 2023
      </time></p>
  </header>
  <div class="post-content e-content" itemprop="articleBody">
    <p>In this post i will show you how to use the <a href="https://docs.sympy.org/latest/modules/tensor/index.html">Sympy Tensor</a> module to calculate the covariant derivative of an arbitrary tensor field on a Riemannian manifold.
I also show how to calculate the Christoffel symbols and the different curvature quantities (Riemann tensor, Ricci tensor, scalar curvature). If you want to learn more about the Sympy Tensor module, i also wrote a post describing its features <a href="https://jd11111.github.io/2023/06/23/SympyTensor.html">here</a>.</p>

<p>The following topics are covered:</p>

<ul>
  <li><a href="#general-code">General Code</a>
    <ul>
      <li><a href="#natural-derivative-and-christoffel-symbols">Natural Derivative and Christoffel Symbols</a></li>
      <li><a href="#covariant-derivative">Covariant Derivative</a></li>
      <li><a href="#riemann-curvature">Riemann Curvature</a></li>
    </ul>
  </li>
  <li><a href="#example-the-2-sphere">Example: The 2 Sphere</a>
    <ul>
      <li><a href="#calculation-of-the-christoffel-symbols">Christoffel Symbols</a></li>
      <li><a href="#differential-operators-in-spherical-coordinates">Differential Operators</a></li>
      <li><a href="#calculating-the-curvature-of-the-sphere">Curvature of the Sphere</a></li>
    </ul>
  </li>
</ul>

<h1 id="general-code">General Code</h1>

<p>In this section i will show you and briefly describe the code to compute curvature and the covariant derivative.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="n">sympy.tensor.tensor</span> <span class="kn">import</span> <span class="n">TensorIndexType</span><span class="p">,</span> <span class="n">TensorHead</span><span class="p">,</span> <span class="n">TensorSymmetry</span><span class="p">,</span> <span class="n">tensor_indices</span> 
<span class="kn">from</span> <span class="n">sympy.tensor.toperators</span> <span class="kn">import</span> <span class="n">PartialDerivative</span>
<span class="kn">from</span> <span class="n">sympy</span> <span class="kn">import</span> <span class="n">symbols</span>
<span class="kn">from</span> <span class="n">sympy.combinatorics</span> <span class="kn">import</span> <span class="n">Permutation</span>
<span class="kn">import</span> <span class="n">math</span>
<span class="kn">import</span> <span class="n">sympy</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">V</span><span class="o">=</span> <span class="nc">TensorIndexType</span><span class="p">(</span><span class="sh">'</span><span class="s">V</span><span class="sh">'</span><span class="p">,</span> <span class="n">dummy_name</span><span class="o">=</span><span class="sh">'</span><span class="s">l</span><span class="sh">'</span><span class="p">,</span><span class="n">metric_name</span><span class="o">=</span><span class="sh">"</span><span class="s">g</span><span class="sh">"</span><span class="p">)</span>
<span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span><span class="n">c</span><span class="p">,</span><span class="n">d</span><span class="p">,</span><span class="n">e</span><span class="p">,</span><span class="n">h</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="n">j</span>  <span class="o">=</span> <span class="nf">tensor_indices</span><span class="p">(</span><span class="sh">'</span><span class="s">a, b,c,d,e,h,i,j</span><span class="sh">'</span><span class="p">,</span> <span class="n">V</span><span class="p">)</span> <span class="c1">#create two indices associated to V (the same as the abcde etc above)
</span>
<span class="n">A</span> <span class="o">=</span> <span class="nc">TensorHead</span><span class="p">(</span><span class="sh">"</span><span class="s">A</span><span class="sh">"</span><span class="p">,</span> <span class="p">[</span><span class="n">V</span><span class="p">])</span>
<span class="n">B</span> <span class="o">=</span> <span class="nc">TensorHead</span><span class="p">(</span><span class="sh">"</span><span class="s">B</span><span class="sh">"</span><span class="p">,</span> <span class="p">[</span><span class="n">V</span><span class="p">,</span><span class="n">V</span><span class="p">])</span>
<span class="n">C</span> <span class="o">=</span> <span class="nc">TensorHead</span><span class="p">(</span><span class="sh">"</span><span class="s">C</span><span class="sh">"</span><span class="p">,</span> <span class="p">[</span><span class="n">V</span><span class="p">])</span>

<span class="n">x</span> <span class="o">=</span> <span class="nc">TensorHead</span><span class="p">(</span><span class="sh">"</span><span class="s">x</span><span class="sh">"</span><span class="p">,</span> <span class="p">[</span><span class="n">V</span><span class="p">])</span> <span class="c1"># storing the variables to derive by in the natural derivative
</span>
<span class="n">sym</span> <span class="o">=</span> <span class="n">TensorSymmetry</span><span class="p">.</span><span class="nf">fully_symmetric</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="c1">#metric tensor is symmetric 
</span><span class="n">g</span> <span class="o">=</span> <span class="nc">TensorHead</span><span class="p">(</span><span class="sh">"</span><span class="s">g</span><span class="sh">"</span><span class="p">,</span> <span class="p">[</span><span class="n">V</span><span class="p">,</span><span class="n">V</span><span class="p">],</span><span class="n">sym</span><span class="p">)</span> <span class="c1">#metric tensor 
</span>
<span class="n">rie_sym</span> <span class="o">=</span> <span class="n">TensorSymmetry</span><span class="p">.</span><span class="nf">riemann</span><span class="p">()</span> <span class="c1">#symmetry of Riemann curvature
</span><span class="n">R</span> <span class="o">=</span> <span class="nc">TensorHead</span><span class="p">(</span><span class="sh">"</span><span class="s">R</span><span class="sh">"</span><span class="p">,[</span><span class="n">V</span><span class="p">,</span><span class="n">V</span><span class="p">,</span><span class="n">V</span><span class="p">,</span><span class="n">V</span><span class="p">],</span><span class="n">rie_sym</span><span class="p">)</span>

<span class="n">Csym</span> <span class="o">=</span> <span class="n">TensorSymmetry</span><span class="p">.</span><span class="nf">direct_product</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span> <span class="c1">#symmetry of Christoffel symbols
</span><span class="n">G</span> <span class="o">=</span> <span class="nc">TensorHead</span><span class="p">(</span><span class="sa">r</span><span class="sh">"</span><span class="s">\Gamma</span><span class="sh">"</span><span class="p">,[</span><span class="n">V</span><span class="p">,</span><span class="n">V</span><span class="p">,</span><span class="n">V</span><span class="p">],</span><span class="n">Csym</span><span class="p">)</span> 
</code></pre></div></div>

<h2 id="natural-derivative-and-christoffel-symbols">Natural Derivative And Christoffel Symbols</h2>

<p>Firstly define the natural derivative:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">ord_der</span><span class="p">(</span><span class="n">new_ind</span><span class="p">,</span><span class="n">expr</span><span class="p">):</span>
    <span class="k">return</span> <span class="nc">PartialDerivative</span><span class="p">(</span><span class="n">expr</span><span class="p">,</span><span class="nf">x</span><span class="p">(</span><span class="n">new_ind</span><span class="p">))</span>
</code></pre></div></div>

<p>The Christoffel symbols are obtained from the metric and the natural derivative by the following formula:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">ch_syms</span> <span class="o">=</span> <span class="nf">g</span><span class="p">(</span><span class="n">c</span><span class="p">,</span><span class="n">d</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="nf">ord_der</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="nf">g</span><span class="p">(</span><span class="o">-</span><span class="n">b</span><span class="p">,</span><span class="o">-</span><span class="n">d</span><span class="p">))</span><span class="o">+</span><span class="nf">ord_der</span><span class="p">(</span><span class="n">b</span><span class="p">,</span><span class="nf">g</span><span class="p">(</span><span class="o">-</span><span class="n">a</span><span class="p">,</span><span class="o">-</span><span class="n">d</span><span class="p">))</span> <span class="o">-</span><span class="nf">ord_der</span><span class="p">(</span><span class="n">d</span><span class="p">,</span><span class="nf">g</span><span class="p">(</span><span class="o">-</span><span class="n">a</span><span class="p">,</span><span class="o">-</span><span class="n">b</span><span class="p">)))</span><span class="o">/</span><span class="mi">2</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">ch_syms</span>
</code></pre></div></div>

<p>\begin{equation}
\displaystyle \left(\frac{1}{2}\right)g{}^{cl_{0}}\left(\frac{\partial}{\partial {x{}^{a}}}{g{}_{bl_{0}}} + \frac{\partial}{\partial {x{}^{b}}}{g{}_{al_{0}}} + \left(-1\right)\frac{\partial}{\partial {x{}^{l_{0}}}}{g{}_{ab}}\right)
\end{equation}</p>

<h2 id="covariant-derivative">Covariant Derivative</h2>

<p>Define the covariant derivative from the well known formula in terms of Christoffel symbols:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">cov_der</span><span class="p">(</span><span class="n">new_ind</span><span class="p">,</span><span class="n">expr</span><span class="p">):</span>
    <span class="n">inds</span> <span class="o">=</span> <span class="n">expr</span><span class="p">.</span><span class="nf">get_free_indices</span><span class="p">()</span>
    <span class="n">rexpr</span> <span class="o">=</span> <span class="nf">ord_der</span><span class="p">(</span><span class="n">new_ind</span><span class="p">,</span><span class="n">expr</span><span class="p">)</span>
    <span class="n">dummy</span> <span class="o">=</span> <span class="nf">tensor_indices</span><span class="p">(</span><span class="sh">"</span><span class="s">d_asdf</span><span class="sh">"</span><span class="p">,</span> <span class="n">V</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">t_ind</span> <span class="ow">in</span> <span class="n">inds</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">t_ind</span><span class="p">.</span><span class="n">is_up</span><span class="p">:</span>
            <span class="n">contract_expr</span> <span class="o">=</span> <span class="n">expr</span><span class="p">.</span><span class="nf">substitute_indices</span><span class="p">({</span><span class="n">t_ind</span><span class="p">:</span><span class="n">dummy</span><span class="p">,</span><span class="n">dummy</span><span class="p">:</span><span class="bp">None</span><span class="p">})</span>
            <span class="n">rexpr</span> <span class="o">+=</span> <span class="nc">G</span><span class="p">(</span><span class="n">t_ind</span><span class="p">,</span><span class="o">-</span><span class="n">new_ind</span><span class="p">,</span><span class="o">-</span><span class="n">dummy</span><span class="p">)</span><span class="o">*</span><span class="n">contract_expr</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">contract_expr</span> <span class="o">=</span> <span class="n">expr</span><span class="p">.</span><span class="nf">substitute_indices</span><span class="p">({</span><span class="o">-</span><span class="n">t_ind</span><span class="p">:</span><span class="o">-</span><span class="n">dummy</span><span class="p">,</span><span class="n">dummy</span><span class="p">:</span><span class="bp">None</span><span class="p">})</span>
            <span class="n">rexpr</span> <span class="o">+=</span> <span class="o">-</span><span class="nc">G</span><span class="p">(</span><span class="n">dummy</span><span class="p">,</span><span class="o">-</span><span class="n">new_ind</span><span class="p">,</span><span class="n">t_ind</span><span class="p">)</span><span class="o">*</span><span class="n">contract_expr</span>
    <span class="k">return</span> <span class="n">rexpr</span>
</code></pre></div></div>

<p>Time to check if it works in some special cases:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">E</span> <span class="o">=</span> <span class="nc">TensorHead</span><span class="p">(</span><span class="sh">"</span><span class="s">E</span><span class="sh">"</span><span class="p">,[</span><span class="n">V</span><span class="p">,</span><span class="n">V</span><span class="p">,</span><span class="n">V</span><span class="p">])</span>
<span class="n">T</span> <span class="o">=</span> <span class="nc">TensorHead</span><span class="p">(</span><span class="sh">"</span><span class="s">T</span><span class="sh">"</span><span class="p">,[</span><span class="n">V</span><span class="p">])</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nf">cov_der</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="nc">E</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">,</span><span class="o">-</span><span class="n">c</span><span class="p">))</span>
</code></pre></div></div>

<p>\begin{equation}
\displaystyle -\Gamma{}^{l_{0}}{}_{l_{1}c}E{}^{l_{1}b}{}_{l_{0}} + \Gamma{}^{b}{}_{l_{0}l_{1}}E{}^{l_{0}l_{1}}{}_{c} + \Gamma{}^{l_{0}}{}_{l_{0}l_{1}}E{}^{l_{1}b}{}_{c} + \frac{\partial}{\partial {x{}^{l_{0}}}}{E{}^{l_{0}b}{}_{c}}
\end{equation}</p>

<p>Divergence of a vector field:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">divA</span> <span class="o">=</span> <span class="nf">cov_der</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="nc">A</span><span class="p">(</span><span class="n">i</span><span class="p">))</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">divA</span>
</code></pre></div></div>

<p>\begin{equation}
\displaystyle \Gamma{}^{l_{0}}{}_{l_{0}l_{1}}A{}^{l_{1}} + \frac{\partial}{\partial {x{}^{l_{0}}}}{A{}^{l_{0}}}
\end{equation}</p>

<h2 id="riemann-curvature">Riemann Curvature</h2>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">symmetrizer</span><span class="p">(</span><span class="n">t</span><span class="p">,</span><span class="n">indices</span><span class="p">,</span><span class="n">anti</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
    <span class="sh">"""</span><span class="s">(Anti)-symmetrize the factors of a tensor (expression) t which are included in the indices list</span><span class="sh">"""</span>
    <span class="n">sym</span> <span class="o">=</span><span class="n">t</span>
    <span class="n">N</span> <span class="o">=</span> <span class="nf">len</span><span class="p">(</span><span class="n">indices</span><span class="p">)</span>
    <span class="n">ind_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nf">range</span><span class="p">(</span><span class="n">N</span><span class="p">)]</span> 
    <span class="n">map_dict</span> <span class="o">=</span> <span class="nf">dict</span><span class="p">(</span><span class="nf">zip</span><span class="p">(</span><span class="n">ind_list</span><span class="p">,</span><span class="n">indices</span><span class="p">))</span> <span class="c1">#maps number to the corresponding index object
</span>    <span class="n">p</span> <span class="o">=</span> <span class="nc">Permutation</span><span class="p">(</span><span class="n">ind_list</span><span class="p">)</span> 
    <span class="k">while</span> <span class="n">p</span><span class="p">.</span><span class="nf">next_trotterjohnson</span><span class="p">()</span> <span class="o">!=</span> <span class="bp">None</span><span class="p">:</span> <span class="c1">#if all permutations have been looped stop
</span>        <span class="n">p</span> <span class="o">=</span> <span class="n">p</span><span class="p">.</span><span class="nf">next_trotterjohnson</span><span class="p">()</span> <span class="c1">#next permutation
</span>        <span class="n">repl_dict</span> <span class="o">=</span> <span class="p">{</span><span class="n">indices</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="p">:</span> <span class="n">map_dict</span><span class="p">[</span><span class="n">p</span><span class="p">.</span><span class="nf">list</span><span class="p">()[</span><span class="n">i</span><span class="p">]]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">ind_list</span><span class="p">}</span><span class="c1">#replacement dict with the correct permutation
</span>        <span class="k">if</span> <span class="ow">not</span> <span class="n">anti</span><span class="p">:</span>
            <span class="n">sym</span> <span class="o">+=</span> <span class="n">t</span><span class="p">.</span><span class="nf">_replace_indices</span><span class="p">(</span><span class="n">repl_dict</span><span class="p">)</span> <span class="c1">#symmetrization
</span>        <span class="k">else</span><span class="p">:</span>
            <span class="n">sym</span> <span class="o">+=</span> <span class="n">p</span><span class="p">.</span><span class="nf">signature</span><span class="p">()</span><span class="o">*</span><span class="n">t</span><span class="p">.</span><span class="nf">_replace_indices</span><span class="p">(</span><span class="n">repl_dict</span><span class="p">)</span> <span class="c1">#anti-symmetrization
</span>    <span class="k">return</span> <span class="n">sym</span><span class="o">/</span><span class="p">(</span><span class="n">math</span><span class="p">.</span><span class="nf">factorial</span><span class="p">(</span><span class="n">N</span><span class="p">))</span>
</code></pre></div></div>

<p>Define the Riemann curvature tensor $R^{a}{}_{bcd}$ from the well known expression in terms of Christoffel symbols</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">Rie</span> <span class="o">=</span> <span class="o">-</span><span class="mi">2</span><span class="o">*</span><span class="nf">symmetrizer</span><span class="p">(</span><span class="nf">ord_der</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="nc">G</span><span class="p">(</span><span class="n">d</span><span class="p">,</span><span class="o">-</span><span class="n">b</span><span class="p">,</span><span class="o">-</span><span class="n">c</span><span class="p">)),[</span><span class="o">-</span><span class="n">a</span><span class="p">,</span><span class="o">-</span><span class="n">b</span><span class="p">],</span><span class="n">anti</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span> \
    <span class="o">+</span> <span class="mi">2</span><span class="o">*</span><span class="nf">symmetrizer</span><span class="p">(</span><span class="nc">G</span><span class="p">(</span><span class="n">e</span><span class="p">,</span><span class="o">-</span><span class="n">c</span><span class="p">,</span><span class="o">-</span><span class="n">a</span><span class="p">)</span><span class="o">*</span><span class="nc">G</span><span class="p">(</span><span class="n">d</span><span class="p">,</span><span class="o">-</span><span class="n">b</span><span class="p">,</span><span class="o">-</span><span class="n">e</span><span class="p">),[</span><span class="o">-</span><span class="n">a</span><span class="p">,</span><span class="o">-</span><span class="n">b</span><span class="p">],</span><span class="n">anti</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">Rie</span>
</code></pre></div></div>

<p>\begin{equation}
\displaystyle -\Gamma{}^{l_{0}}{}_{cb}\Gamma{}^{d}{}_{al_{0}} - \left(\frac{\partial}{\partial {x{}^{a}}}{\Gamma{}^{d}{}_{bc}} + \left(-1\right)\frac{\partial}{\partial {x{}^{b}}}{\Gamma{}^{d}{}_{ac}}\right) + \Gamma{}^{l_{0}}{}_{ca}\Gamma{}^{d}{}_{bl_{0}}
\end{equation}</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">Rie</span><span class="p">.</span><span class="n">free_indices</span>
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[d, -b, -c, -a]
</code></pre></div></div>

<h1 id="example-the-2-sphere">Example: The 2 Sphere</h1>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="n">sympy</span> <span class="kn">import</span> <span class="n">diag</span>
<span class="n">theta</span><span class="p">,</span> <span class="n">phi</span><span class="p">,</span><span class="n">r</span> <span class="o">=</span> <span class="nf">symbols</span><span class="p">(</span><span class="sa">r</span><span class="sh">"</span><span class="s">\theta \varphi r</span><span class="sh">"</span><span class="p">)</span>
</code></pre></div></div>

<p>In this example the first coordinate will be $\theta$ (polar angle) and the second $\varphi$ (azimuthal angle). The radius $r$ of the sphere is a constant.</p>

<p>Inserting the coordinate matrix of the metric tensor</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">repl</span> <span class="o">=</span> <span class="p">{</span>
    <span class="n">V</span> <span class="p">:</span> <span class="nf">diag</span><span class="p">(</span><span class="n">r</span><span class="o">**</span><span class="mi">2</span><span class="p">,</span><span class="n">r</span><span class="o">**</span><span class="mi">2</span><span class="o">*</span><span class="n">sympy</span><span class="p">.</span><span class="nf">sin</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">),</span>
    <span class="nf">g</span><span class="p">(</span><span class="o">-</span><span class="n">e</span><span class="p">,</span><span class="o">-</span><span class="n">j</span><span class="p">)</span> <span class="p">:</span> <span class="nf">diag</span><span class="p">(</span><span class="n">r</span><span class="o">**</span><span class="mi">2</span><span class="p">,</span><span class="n">r</span><span class="o">**</span><span class="mi">2</span><span class="o">*</span><span class="n">sympy</span><span class="p">.</span><span class="nf">sin</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">),</span>
    <span class="nf">x</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="p">:</span> <span class="p">[</span><span class="n">theta</span><span class="p">,</span> <span class="n">phi</span><span class="p">]</span>
        <span class="p">}</span>
</code></pre></div></div>

<p>The components $g_{\mu \nu}$ of the metric $g$ are:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nf">g</span><span class="p">(</span><span class="o">-</span><span class="n">e</span><span class="p">,</span><span class="o">-</span><span class="n">j</span><span class="p">).</span><span class="nf">replace_with_arrays</span><span class="p">(</span><span class="n">repl</span><span class="p">)</span>
</code></pre></div></div>

<p>\begin{equation}
\displaystyle \left[\begin{matrix}r^{2} &amp; 0\\0 &amp; r^{2} \sin^{2}{\left(\theta \right)}\end{matrix}\right]
\end{equation}</p>

<h2 id="calculation-of-the-christoffel-symbols">Calculation of the Christoffel-Symbols</h2>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">ch_syms</span>
</code></pre></div></div>

<p>\begin{equation}
\displaystyle \left(\frac{1}{2}\right)g{}^{cl_{0}}\left(\frac{\partial}{\partial {x{}^{a}}}{g{}_{bl_{0}}} + \frac{\partial}{\partial {x{}^{b}}}{g{}_{al_{0}}} + \left(-1\right)\frac{\partial}{\partial {x{}^{l_{0}}}}{g{}_{ab}}\right)
\end{equation}</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">G_coord</span> <span class="o">=</span> <span class="n">ch_syms</span><span class="p">.</span><span class="nf">replace_with_arrays</span><span class="p">(</span><span class="n">repl</span><span class="p">)</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">repl</span><span class="p">.</span><span class="nf">update</span><span class="p">({</span><span class="nc">G</span><span class="p">(</span><span class="n">e</span><span class="p">,</span><span class="o">-</span><span class="n">j</span><span class="p">,</span><span class="o">-</span><span class="n">h</span><span class="p">):</span> <span class="n">G_coord</span><span class="p">})</span>
</code></pre></div></div>

<p>The Christoffel Symbols $\Gamma^\mu_{\nu \rho}$ are:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nc">G</span><span class="p">(</span><span class="n">d</span><span class="p">,</span><span class="o">-</span><span class="n">a</span><span class="p">,</span><span class="o">-</span><span class="n">b</span><span class="p">).</span><span class="nf">replace_with_arrays</span><span class="p">(</span><span class="n">repl</span><span class="p">)</span>
</code></pre></div></div>

<p>\begin{equation}
\displaystyle \left[\begin{matrix}\left[\begin{matrix}0 &amp; 0\\0 &amp; - \sin{\left(\theta \right)} \cos{\left(\theta \right)}\end{matrix}\right] &amp; \left[\begin{matrix}0 &amp; \frac{\cos{\left(\theta \right)}}{\sin{\left(\theta \right)}}\\\frac{\cos{\left(\theta \right)}}{\sin{\left(\theta \right)}} &amp; 0\end{matrix}\right]\end{matrix}\right]
\end{equation}</p>

<h2 id="differential-operators-in-spherical-coordinates">Differential Operators In Spherical Coordinates</h2>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">df</span> <span class="o">=</span> <span class="nc">TensorHead</span><span class="p">(</span><span class="sh">"</span><span class="s">df</span><span class="sh">"</span><span class="p">,[</span><span class="n">V</span><span class="p">])</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">fun</span> <span class="o">=</span> <span class="n">sympy</span><span class="p">.</span><span class="nc">Function</span><span class="p">(</span><span class="sh">'</span><span class="s">f</span><span class="sh">'</span><span class="p">)(</span><span class="n">theta</span><span class="p">,</span><span class="n">phi</span><span class="p">)</span>
</code></pre></div></div>

<h3 id="the-gradient-in-spherical-coordinates">The Gradient In Spherical Coordinates</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">repl</span><span class="p">.</span><span class="nf">update</span><span class="p">({</span><span class="nf">df</span><span class="p">(</span><span class="o">-</span><span class="n">i</span><span class="p">)</span> <span class="p">:</span> <span class="p">[</span><span class="n">sympy</span><span class="p">.</span><span class="nc">Derivative</span><span class="p">(</span><span class="n">fun</span><span class="p">,</span><span class="n">theta</span><span class="p">),</span><span class="n">sympy</span><span class="p">.</span><span class="nc">Derivative</span><span class="p">(</span><span class="n">fun</span><span class="p">,</span><span class="n">phi</span><span class="p">)]})</span>
</code></pre></div></div>

<p>The components $(\mathrm{grad}f)_\mu$ of the gradient are:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nf">df</span><span class="p">(</span><span class="n">i</span><span class="p">).</span><span class="nf">replace_with_arrays</span><span class="p">(</span><span class="n">repl</span><span class="p">)</span>
</code></pre></div></div>

<p>\begin{equation}
\displaystyle \left[\begin{matrix}\frac{\frac{\partial}{\partial \theta} f{\left(\theta,\varphi \right)}}{r^{2}} &amp; \frac{\frac{\partial}{\partial \varphi} f{\left(\theta,\varphi \right)}}{r^{2} \sin^{2}{\left(\theta \right)}}\end{matrix}\right]
\end{equation}</p>

<h3 id="the-laplacian">The Laplacian</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">laplace</span> <span class="o">=</span> <span class="nf">cov_der</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="nf">df</span><span class="p">(</span><span class="n">i</span><span class="p">))</span>
</code></pre></div></div>

<p>The laplacian $\Delta f$ is:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">laplace</span><span class="p">.</span><span class="nf">replace_with_arrays</span><span class="p">(</span><span class="n">repl</span><span class="p">)</span>
</code></pre></div></div>

<p>\begin{equation}
\displaystyle \frac{\frac{\partial^{2}}{\partial \theta^{2}} f{\left(\theta,\varphi \right)}}{r^{2}} + \frac{\cos{\left(\theta \right)} \frac{\partial}{\partial \theta} f{\left(\theta,\varphi \right)}}{r^{2} \sin{\left(\theta \right)}} + \frac{\frac{\partial^{2}}{\partial \varphi^{2}} f{\left(\theta,\varphi \right)}}{r^{2} \sin^{2}{\left(\theta \right)}}
\end{equation}</p>

<h3 id="the-divergence-of-a-vectorfield">The Divergence Of A Vectorfield</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">Aphi</span><span class="o">=</span> <span class="n">sympy</span><span class="p">.</span><span class="nc">Function</span><span class="p">(</span><span class="sa">r</span><span class="sh">'</span><span class="s">A^\varphi</span><span class="sh">'</span><span class="p">)(</span><span class="n">theta</span><span class="p">,</span><span class="n">phi</span><span class="p">)</span>
<span class="n">Atheta</span> <span class="o">=</span> <span class="n">sympy</span><span class="p">.</span><span class="nc">Function</span><span class="p">(</span><span class="sa">r</span><span class="sh">'</span><span class="s">A^\theta</span><span class="sh">'</span><span class="p">)(</span><span class="n">theta</span><span class="p">,</span><span class="n">phi</span><span class="p">)</span>
<span class="n">repl</span><span class="p">.</span><span class="nf">update</span><span class="p">({</span><span class="nc">A</span><span class="p">(</span><span class="n">i</span><span class="p">):[</span><span class="n">Atheta</span><span class="p">,</span><span class="n">Aphi</span><span class="p">]})</span>
</code></pre></div></div>

<p>So that the vector field is $A^i = A^\theta \frac{\partial}{\partial \theta} + A^\varphi \frac{\partial}{\partial \varphi} $</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">divA</span>
</code></pre></div></div>

<p>\begin{equation}
\displaystyle \Gamma{}^{l_{0}}{}_{l_{0}l_{1}}A{}^{l_{1}} + \frac{\partial}{\partial {x{}^{l_{0}}}}{A{}^{l_{0}}}
\end{equation}</p>

<p>The divergence $\mathrm{div}A$ is:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">divA</span><span class="p">.</span><span class="nf">replace_with_arrays</span><span class="p">(</span><span class="n">repl</span><span class="p">)</span>
</code></pre></div></div>

<p>\begin{equation}
\displaystyle \frac{A^{\theta}{\left(\theta,\varphi \right)} \cos{\left(\theta \right)}}{\sin{\left(\theta \right)}} + \frac{\partial}{\partial \theta} A^{\theta}{\left(\theta,\varphi \right)} + \frac{\partial}{\partial \varphi} A^{\varphi}{\left(\theta,\varphi \right)}
\end{equation}</p>

<h2 id="calculating-the-curvature-of-the-sphere">Calculating The Curvature Of The Sphere</h2>

<p>Riemann Curvature:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">Rie</span>
</code></pre></div></div>

<p>\begin{equation}
\displaystyle -\Gamma{}^{l_{0}}{}_{cb}\Gamma{}^{d}{}_{al_{0}} - \left(\frac{\partial}{\partial {x{}^{a}}}{\Gamma{}^{d}{}_{bc}} + \left(-1\right)\frac{\partial}{\partial {x{}^{b}}}{\Gamma{}^{d}{}_{ac}}\right) + \Gamma{}^{l_{0}}{}_{ca}\Gamma{}^{d}{}_{bl_{0}}
\end{equation}</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">Rie_coord</span> <span class="o">=</span> <span class="n">Rie</span><span class="p">.</span><span class="nf">replace_with_arrays</span><span class="p">(</span><span class="n">repl</span><span class="p">,[</span><span class="o">-</span><span class="n">a</span><span class="p">,</span><span class="o">-</span><span class="n">b</span><span class="p">,</span><span class="o">-</span><span class="n">c</span><span class="p">,</span><span class="o">-</span><span class="n">d</span><span class="p">])</span>
</code></pre></div></div>

<p>The components $R_{\mu \nu \rho \sigma}$ of the Riemann curvature tensor are:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">Rie_coord</span>
</code></pre></div></div>

<p>\begin{equation}
\displaystyle \left[\begin{matrix}\left[\begin{matrix}0 &amp; 0\\0 &amp; 0\end{matrix}\right] &amp; \left[\begin{matrix}0 &amp; r^{2} \sin^{2}{\left(\theta \right)}\\- r^{2} \sin^{2}{\left(\theta \right)} &amp; 0\end{matrix}\right]\\\left[\begin{matrix}0 &amp; - r^{2} \sin^{2}{\left(\theta \right)}\\r^{2} \sin^{2}{\left(\theta \right)} &amp; 0\end{matrix}\right] &amp; \left[\begin{matrix}0 &amp; 0\\0 &amp; 0\end{matrix}\right]\end{matrix}\right]
\end{equation}</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">repl</span><span class="p">.</span><span class="nf">update</span><span class="p">({</span><span class="nc">R</span><span class="p">(</span><span class="o">-</span><span class="n">a</span><span class="p">,</span><span class="o">-</span><span class="n">b</span><span class="p">,</span><span class="o">-</span><span class="n">c</span><span class="p">,</span><span class="o">-</span><span class="n">d</span><span class="p">):</span> <span class="n">Rie_coord</span><span class="p">})</span>
</code></pre></div></div>

<p>The components $R^\mu{}_{\nu \rho \sigma}$ of the Riemann curvature tensor are:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nc">R</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="o">-</span><span class="n">b</span><span class="p">,</span><span class="o">-</span><span class="n">c</span><span class="p">,</span><span class="o">-</span><span class="n">d</span><span class="p">).</span><span class="nf">replace_with_arrays</span><span class="p">(</span><span class="n">repl</span><span class="p">)</span>
</code></pre></div></div>

<p>\begin{equation}
\displaystyle \left[\begin{matrix}\left[\begin{matrix}0 &amp; 0\\0 &amp; 0\end{matrix}\right] &amp; \left[\begin{matrix}0 &amp; \sin^{2}{\left(\theta \right)}\\- \sin^{2}{\left(\theta \right)} &amp; 0\end{matrix}\right]\\\left[\begin{matrix}0 &amp; -1\\1 &amp; 0\end{matrix}\right] &amp; \left[\begin{matrix}0 &amp; 0\\0 &amp; 0\end{matrix}\right]\end{matrix}\right]
\end{equation}</p>

<p>Ricci Curvature:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">Ric</span> <span class="o">=</span> <span class="nc">R</span><span class="p">(</span><span class="n">e</span><span class="p">,</span><span class="o">-</span><span class="n">a</span><span class="p">,</span><span class="o">-</span><span class="n">e</span><span class="p">,</span><span class="o">-</span><span class="n">b</span><span class="p">)</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">Ric</span>
</code></pre></div></div>

<p>\begin{equation}
\displaystyle R{}^{l_{0}}{}_{al_{0}b}
\end{equation}</p>

<p>The components $\mathrm{Ric}_{\mu \nu}$ of the Ricci Tensor are:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">Ric</span><span class="p">.</span><span class="nf">replace_with_arrays</span><span class="p">(</span><span class="n">repl</span><span class="p">)</span>
</code></pre></div></div>

<p>\begin{equation}
\displaystyle \left[\begin{matrix}1 &amp; 0\\0 &amp; \sin^{2}{\left(\theta \right)}\end{matrix}\right]
\end{equation}</p>

<p>Scalar Curvature:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">S</span> <span class="o">=</span> <span class="n">Ric</span><span class="p">.</span><span class="nf">_replace_indices</span><span class="p">({</span><span class="o">-</span><span class="n">a</span><span class="p">:</span><span class="n">a</span><span class="p">,</span><span class="o">-</span><span class="n">b</span><span class="p">:</span><span class="o">-</span><span class="n">a</span><span class="p">})</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">S</span>
</code></pre></div></div>

<p>\begin{equation}
\displaystyle R{}^{l_{0}a}{}_{l_{0}a}
\end{equation}</p>

<p>The scalar curvature is:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">S</span><span class="p">.</span><span class="nf">replace_with_arrays</span><span class="p">(</span><span class="n">repl</span><span class="p">)</span>
</code></pre></div></div>

<p>\begin{equation}
\displaystyle \frac{2}{r^{2}}
\end{equation}</p>


  </div><a class="u-url" href="/2023/06/28/RieGeoTens.html" hidden></a>
</article>

      </div>
    </main><footer class="site-footer h-card">
  <data class="u-url" href="/"></data>

  <div class="wrapper">

    <h2 class="footer-heading">Jannik&#39;s Blog</h2>

    <div class="footer-col-wrapper">
      <div class="footer-col footer-col-1">
        <ul class="contact-list">
          <li class="p-name">Jannik&#39;s Blog</li><li><a class="u-email" href="mailto:jannik.daun@proton.me">jannik.daun@proton.me</a></li></ul>
      </div>

      <div class="footer-col footer-col-2"><ul class="social-media-list"><li><a href="https://github.com/jd11111"><svg class="svg-icon"><use xlink:href="/assets/minima-social-icons.svg#github"></use></svg> <span class="username">jd11111</span></a></li></ul>
</div>

      <div class="footer-col footer-col-3">
        <p>Blog about things Jannik is currently interested in</p>
      </div>
    </div>

  </div>

</footer>
</body>

</html>
